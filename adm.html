<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <link rel="stylesheet" href="/assets/css/main-adm.css" />
    <title>Local IFPI - ADM</title>
  </head>

  <body>
    <div id="app">

      <header>

        <div class="nav">

          <div class="logo-titulo">
              <a href="../index.html"><img src="../assets/icons/logo-ifpi.svg" alt="Logo IFPI" /></a>
          </div>

          <a class="painel" href="/pages/painel.html">Painel</a>

          <div class="search-container">
              <input
                  type="search"
                  id="buscarSala"
                  name="buscarSala"
                  placeholder="Buscar sala..."
                  autocomplete="off"
                  v-model.trim="termoBusca"
                  @keydown.enter.prevent
              />
              <span class="material-symbols-outlined lupa">search</span>
          </div>

          <a class="sair" href="../index.html">Sair</a>

        </div>


      </header>

      <main>
        <div class="map-container"
        touchstart="startRotate" 
        @touchmove="doRotate"
        @touchend="endRotate">
        <div id="map-rotator" :style="rotationStyle">
          <div class="container">
            <div class="elemento elemento-1"></div>
            <div class="elemento elemento-2"></div>
            <div class="elemento elemento-3 marker-quadra"></div>
            <div class="elemento elemento-4"></div>
            <div class="elemento elemento-5"></div>
            <div class="elemento elemento-6"></div>
            <div class="elemento elemento-7"></div>
            <div class="elemento elemento-8"></div>
            <div class="elemento elemento-9"></div>
            <div class="elemento elemento-10"></div>
            <div class="elemento elemento-11"></div>
            <div class="elemento elemento-12"></div>
            <div class="elemento elemento-13"></div>
            <div class="elemento elemento-14"></div>
            <div class="elemento elemento-15"></div>
            <div class="elemento elemento-16"></div>
            <div class="elemento elemento-17"></div>
            <div class="elemento elemento-18"></div>
            <div class="elemento elemento-19"></div>
            <div class="elemento elemento-20"></div>
            <div class="elemento elemento-21"></div>
            <div class="elemento elemento-22"></div>
            <div class="elemento elemento-23"></div>
            <div class="elemento elemento-24"></div>
            <div class="elemento elemento-25"></div>
            <div class="elemento elemento-26"></div>
            <div class="elemento elemento-27"></div>
            <div class="elemento elemento-28"></div>
            <div class="elemento elemento-29"></div>
            <div class="elemento elemento-30"></div>
            <div class="elemento elemento-31"></div>
            <div class="elemento elemento-32"></div>
            <div class="elemento elemento-33"></div>
            <div class="elemento elemento-34"></div>
            <div class="elemento elemento-35"></div>
            <div class="elemento elemento-36"></div>
            <div class="elemento elemento-37"></div>
            <div class="elemento elemento-38"></div>
            <div class="elemento elemento-39"></div>
            <div class="elemento elemento-40"></div>
            <div class="elemento elemento-41"></div>
            <div class="elemento elemento-42"></div>
            <div class="elemento elemento-43"></div>
            <div class="elemento elemento-44"></div>
            <div class="elemento elemento-45"></div>
            <div class="elemento elemento-46"></div>
            <div class="elemento elemento-47"></div>
            <div class="elemento elemento-48"></div>
            <div class="elemento elemento-49"></div>
            <div class="elemento elemento-50"></div>
            <div class="elemento elemento-51"></div>
            <div class="elemento elemento-52"></div>
            <div class="elemento elemento-53"></div>
            <div class="elemento elemento-54"></div>
            <div class="elemento elemento-55"></div>
            <div class="elemento elemento-56"></div>
            <div class="elemento elemento-57"></div>
            <div class="elemento elemento-58"></div>
            <div class="elemento elemento-59"></div>
            <div class="elemento elemento-60"></div>
            <div class="elemento elemento-61"></div>
            <div class="elemento elemento-62"></div>
            <div class="elemento elemento-63"></div>
            <div class="elemento elemento-64"></div>
            <div class="elemento elemento-65"></div>
            <div class="elemento elemento-66"></div>
            <div class="elemento elemento-67"></div>
            <div class="elemento elemento-68"></div>
            <div class="elemento elemento-69"></div>
            <div class="elemento elemento-70"></div>
            <div class="elemento elemento-71"></div>
            <div class="elemento elemento-72"></div>
            <div class="elemento elemento-73"></div>
            <div class="elemento elemento-74"></div>
            <div class="elemento elemento-75"></div>
            <div class="elemento elemento-76"></div>
            <div class="elemento elemento-77"></div>
            <div class="elemento elemento-78"></div>
            <div class="elemento elemento-79"></div>
            <div class="elemento elemento-80"></div>
            <div class="elemento elemento-81"></div>
            <div class="elemento elemento-82"></div>
            <div class="elemento elemento-83"></div>
            <div class="elemento elemento-84"></div>
            <div class="elemento elemento-85"></div>
            <div class="elemento elemento-86"></div>
            <div class="elemento elemento-87"></div>
            <div class="elemento elemento-88"></div>
            <div class="elemento elemento-89"></div>
            <div class="elemento elemento-90"></div>
            <div class="elemento elemento-91"></div>
            <div class="elemento elemento-92"></div>
            <div class="elemento elemento-93"></div>
            <div class="elemento elemento-94"></div>
          </div>
        </div>
          

          <div
            v-for="bloco in blocosFiltrados"
            :key="bloco.nome + '-marcadores'">
            <div
              v-for="sala in bloco.salas"
              :key="sala.id"
              class="marker"
              :class="'marker-' + (sala.tipo || 'padrao')"
              :style="{ left: sala.x + 'px', top: sala.y + 'px'}"
              @click="mostrarSala(sala)"
              :title="sala.nome">
            </div>
          </div>

          <div v-if="salaSelecionada" class="sala-info">
            <div class="card">
              <div class="header" :class="salaSelecionada.tipo">
                  {{ salaSelecionada.tipo }}
                  <button class="close-btn" @click="salaSelecionada = null">×</button>
                  <span 
                    class="edit-btn" 
                    @click="abrirEditarSala(salaSelecionada)"
                    v-if="!['refeitorio', 'banheiro', 'biblioteca', 'cantina'].includes(salaSelecionada.tipo)"
                  >
                    <img src="/assets/icons/editar.svg">
                  </span>
              </div>

              <div class="info">
                <div class="status">
                  <div class="disp">
                    <div class="disp-ponto" :class="salaSelecionada.disponibilidade.replace(' ', '-')"></div>
                    <span>{{ salaSelecionada.disponibilidade }}</span>
                  </div>
                <div class="capacidade"><span><img src="../assets/icons/cap-icon.svg" class="cap-icon"></span> {{ salaSelecionada.capacidade }} pessoas</div>
              </div>

              <div class="content">
                <h3>Tipo de Sala</h3>
                <p>{{ salaSelecionada.nome }}</p>

                <h3>Horários</h3>
                <table class="schedule-table">
                  <thead>
                    <tr>
                      <th>Manhã</th>
                      <th>Tarde</th>
                      <th>Noite</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>{{ salaSelecionada.horarios?.manha || '' }}</td>
                      <td>{{ salaSelecionada.horarios?.tarde || '' }}</td>
                      <td>{{ salaSelecionada.horarios?.noite || '' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <div v-if="showEditPopup" class="edit-overlay">

            <div class="edit-card">

              <div class="edit-header" :class="salaToEdit.tipo">
                <select v-model="salaToEdit.tipo" class="edit-tipo">
                  <option value="sala">SALA</option>
                  <option value="laboratorio">LABORATÓRIO</option>
                  <option value="administracao">ADMINISTRAÇÃO</option>
                </select>
                <button class="edit-close-btn" @click="fecharEditarSala">×</button>
              </div>

              <div class="edit-info">
                <div class="edit-status">
                  <div class="disp">
                    <div class="disp-ponto" ></div>
                    <select v-model="salaToEdit.disponibilidade" class="disponibilidade-select">
                      <option value="disponivel">Disponível</option>
                      <option value="indisponivel">Indisponível</option>
                      <option value="em-manutencao">Em Manutenção</option>
                    </select>
                  </div>
                  <div class="edit-capacidade">
                    <span><img src="../assets/icons/cap-icon.svg" class="edit-cap-icon"></span> 
                    <input type="number" v-model="salaToEdit.capacidade" class="edit-field small"> pessoas
                  </div>
                </div>
              </div>

              <div class="edit-content">
                <h3>Tipo de Sala</h3>
                <input type="text" v-model="salaToEdit.nome" class="edit-field" placeholder="Ex: Laboratório de Informática I">

                <h3>Horários</h3>
                <table class="schedule-table">
                  <thead>
                    <tr>
                      <th>Manhã</th>
                      <th>Tarde</th>
                      <th>Noite</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><textarea rows="3" cols="13"v-model="salaToEdit.horarios.manha" class="edit-field" ></textarea></td>
                      <td><textarea rows="3" cols="13" v-model="salaToEdit.horarios.tarde" class="edit-field" ></textarea></td>
                      <td><textarea rows="3" cols="13" type="text" v-model="salaToEdit.horarios.noite" class="edit-field" ></textarea></td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="edit-button">
                
                <button @click="salvarEdicao" class="action-button save-button">
                  Salvar
                </button>
              </div>
            </div>
        </div>
      </main>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="/script/map.vue.js"></script>
  </body>
</html>